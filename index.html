<!DOCTYPE html>
	<html>
		<head>
			<meta charset="utf-8" />
			<title>Choose a music</title>
			<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
			<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		</head>
		<body>
		<!--<body style="display:flex; justify-content: center; align-items: center;"> pour conserver le css du body simplement-->
			<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
			<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-firestore.js"></script>
			<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
			<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


			<h1 class="h1" style="text-align:center">Musics List</h1>

			<script type="text/javascript">

				var xhr = new XMLHttpRequest();
					
				function request(url){
					console.log(url)
					xhr.open('GET', url, true);
					xhr.send(null);
				}

				firebase.initializeApp({
					apiKey: 'AIzaSyBEBk4Jimmjz-3VMuhi5pVeDKNrdIr7WIc',
					authDomain: 'test-41ffd.firebaseapp.com',
					projectId: 'test-41ffd'
				});

				var db = firebase.firestore();

				var array = [];

				db.collection("musics").get().then(function(querySnapshot) {
				
					querySnapshot.forEach(function(doc) {
        				// doc.data() is never undefined for query doc snapshots
        				console.log(doc.id, " => ", doc.data());
        				array.push(doc.data().name)
    				});
				}).then( () => {

    				// construire la page html ici avec array
    				var body = document.body
    				var prefix = "https://us-central1-test-41ffd.cloudfunctions.net/hello?name="

    				var Div = document.createElement("div")
					Div.style.margin = "30px"
					
					var A = document.createElement("button")
					A.style.display = "block"
					A.style.overflow = "auto"
					A.style.background = "#4E9CAF"
					A.style.padding = "5px"
					A.style.textAlign = "center"
					A.style.fontSize = "200%"
					A.style.borderRadius = "5px"
					A.style.color = "white"
					A.style.fontWeight = "bold"
				    A.style.textDecoration = "none"
					
    				for(var i=0; i<array.length; i++){

    					var newA = document.createElement("button")

    					newA.style.cssText = A.style.cssText
    					
    					//newA.href = prefix + array[i]

    					newA.setAttribute( "onClick", "request('"+prefix+array[i]+"');" );

    					newA.innerHTML = array[i].split(".")[0]

    					var newDiv = document.createElement("div")

    					newDiv.style.cssText = Div.style.cssText

    					newDiv.classList.add("btn")
    				
    					newDiv.appendChild(newA);
						
    					body.appendChild(newDiv)
    				}

    				//BOUTON STOP

    				var newA = document.createElement("a")

    				newA.style.cssText = A.style.cssText

    				//newA.href = prefix + "stop"

    				newA.setAttribute( "onClick", "request('"+prefix+"stop');" );

    				newA.innerHTML = "STOP"

    				var newDiv = document.createElement("div")

    				newDiv.style.cssText = Div.style.cssText

    				newDiv.appendChild(newA);
						
    				body.appendChild(newDiv)

    			});
			</script>
			</div>
		</body>
	</html>
